<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Your Details | MetaVault</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    /* Custom style to hide number input spinners */
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { 
        -webkit-appearance: none; 
        margin: 0; 
    }
    /* Smooth fade for the success modal */
    .fade-in {
        animation: fadeIn 0.3s ease-out forwards;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }
</style>
</head>

<body class="bg-black text-white min-h-screen flex items-center justify-center p-4 font-sans selection:bg-orange-500 selection:text-white">

<script>
// --- AUTH CHECK (UNCHANGED) ---
const investorId = localStorage.getItem("investorId");
if (!investorId) {
  alert("Session expired. Login again.");
  window.location.href = "loginidv.html";
}
</script>

<div class="relative w-full max-w-2xl">

    <div id="successModal" class="hidden absolute inset-0 z-50 bg-[#111] rounded-2xl flex flex-col items-center justify-center border border-neutral-800 fade-in">
        <div class="bg-green-500/10 p-4 rounded-full mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
        </div>
        <h2 class="text-2xl font-semibold mb-2">Details Saved</h2>
        <p class="text-neutral-400">Redirecting to dashboard in <span id="timer" class="text-orange-500 font-bold">5</span> seconds...</p>
    </div>

    <div class="bg-[#111] border border-neutral-800 p-8 md:p-12 rounded-2xl shadow-2xl">
        
        <div class="mb-10 text-center md:text-left">
            <h1 class="text-3xl md:text-4xl font-light tracking-tight text-white mb-2">Your Details</h1>
            <p class="text-sm text-neutral-500">Please complete your profile information below.</p>
        </div>

        <div class="space-y-6">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="text-xs uppercase tracking-wider text-neutral-500 font-semibold">First Name</label>
                    <input id="firstName" class="w-full bg-black border border-neutral-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all placeholder-neutral-700" placeholder="Jane">
                </div>
                <div class="space-y-2">
                    <label class="text-xs uppercase tracking-wider text-neutral-500 font-semibold">Last Name</label>
                    <input id="lastName" class="w-full bg-black border border-neutral-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all placeholder-neutral-700" placeholder="Doe">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="text-xs uppercase tracking-wider text-neutral-500 font-semibold">Age</label>
                    <input id="age" type="number" class="w-full bg-black border border-neutral-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all placeholder-neutral-700" placeholder="25">
                </div>
                <div class="space-y-2">
                    <label class="text-xs uppercase tracking-wider text-neutral-500 font-semibold">Gender</label>
                    <div class="relative">
                        <select id="gender" class="w-full appearance-none bg-black border border-neutral-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all cursor-pointer">
                            <option value="" class="text-neutral-500">Select Gender</option>
                            <option>Male</option>
                            <option>Female</option>
                            <option>Other</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-neutral-500">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-2">
                <label class="text-xs uppercase tracking-wider text-neutral-500 font-semibold">Phone Number</label>
                <input id="phone" class="w-full bg-black border border-neutral-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all placeholder-neutral-700" placeholder="+1 (555) 000-0000">
            </div>

            <div class="space-y-2">
                <label class="text-xs uppercase tracking-wider text-neutral-500 font-semibold">Address</label>
                <input id="address" class="w-full bg-black border border-neutral-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all placeholder-neutral-700" placeholder="123 Meta St, Block B">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-2">
                    <label class="text-xs uppercase tracking-wider text-neutral-500 font-semibold">City</label>
                    <input id="city" class="w-full bg-black border border-neutral-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all placeholder-neutral-700" placeholder="New York">
                </div>
                <div class="space-y-2">
                    <label class="text-xs uppercase tracking-wider text-neutral-500 font-semibold">State</label>
                    <input id="state" class="w-full bg-black border border-neutral-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all placeholder-neutral-700" placeholder="NY">
                </div>
                <div class="space-y-2">
                    <label class="text-xs uppercase tracking-wider text-neutral-500 font-semibold">Country</label>
                    <input id="country" class="w-full bg-black border border-neutral-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all placeholder-neutral-700" placeholder="USA">
                </div>
            </div>

            <div class="pt-6">
                <button onclick="saveProfile()" class="w-full bg-orange-600 hover:bg-orange-500 text-white font-medium py-4 rounded-lg transition-all duration-200 shadow-[0_0_20px_rgba(234,88,12,0.3)] hover:shadow-[0_0_30px_rgba(234,88,12,0.5)] active:scale-[0.99]">
                    Save Details
                </button>
            </div>

        </div>
    </div>
</div>

<script>
async function saveProfile() {
  // --- ORIGINAL DATA COLLECTION ---
  const data = {
    firstName: document.getElementById('firstName').value,
    lastName: document.getElementById('lastName').value,
    age: Number(document.getElementById('age').value),
    gender: document.getElementById('gender').value,
    phone: document.getElementById('phone').value,
    address: document.getElementById('address').value,
    city: document.getElementById('city').value,
    state: document.getElementById('state').value,
    country: document.getElementById('country').value
  };

  // --- API CALL (UNCHANGED) ---
  // Using try/catch to handle errors gracefully so UI doesn't break
  try {
      const res = await fetch(`http://localhost:4000/api/investor/profile/${investorId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      if (!res.ok) {
        alert("Failed to save details");
        return;
      }

      // --- NEW TIMER LOGIC (Per Request) ---
      // Instead of standard alert, we show the Success Modal
      const modal = document.getElementById('successModal');
      const timerSpan = document.getElementById('timer');
      modal.classList.remove('hidden'); // Show modal

      let timeLeft = 5; // Start at 5 seconds
      
      const countdown = setInterval(() => {
          timeLeft--;
          timerSpan.innerText = timeLeft;
          
          if (timeLeft <= 0) {
              clearInterval(countdown);
              window.location.href = "idv-dashboard.html";
          }
      }, 1000);

  } catch (error) {
      console.error(error);
      alert("An error occurred while connecting to the server.");
  }
}
</script>

</body>
</html>