<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In - MetaVault</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg-light': '#FEFCF5',
            'bg-dark': '#F4F1E8',
            'text-primary': '#111111',
            'accent': '#FF5500',
            'card-bg': '#1A1A1A',
          },
          fontFamily: {
            'main': ['Geist', 'Inter', 'sans-serif'],
          },
        }
      }
    }
  </script>

  <style type="text/tailwindcss">
    @import url('https://fonts.googleapis.com/css2?family=Geist:wght@100..900&display=swap');

    @layer base {
      body {
        font-family: 'Geist', 'Inter', sans-serif;
        -webkit-font-smoothing: antialiased;
      }
    }
  </style>
</head>

<body class="bg-bg-light text-text-primary">

  <div class="h-screen w-screen flex flex-col items-center justify-center">
    <h2 class="text-6xl font-normal tracking-[-0.04em] mb-6">Sign In</h2>

    <div class="bg-card-bg rounded-2xl px-10 py-14 w-[400px] flex flex-col items-center shadow-xl">

      <!-- EMAIL INPUT -->
      <input
        id="emailInput"
        type="email"
        placeholder="Email address"
        class="bg-transparent border border-gray-600 rounded-full px-5 py-3 w-full text-white outline-none text-center mb-5 placeholder:text-gray-500"
      />

      <!-- MAGIC LOGIN -->
      <button
        id="magicLogin"
        class="bg-zinc-800 rounded-full py-3 w-full text-white font-medium mb-3 hover:opacity-90"
      >
        Login using email
      </button>

      <div class="text-gray-500 my-2 text-sm">or</div>

      <!-- METAMASK LOGIN -->
      <button
        id="metamaskLogin"
        class="bg-accent rounded-full py-3 w-full text-black font-medium hover:opacity-90"
      >
        Login with MetaMask
      </button>

    </div>
  </div>

  <!-- Magic SDK -->
  <script src="https://cdn.jsdelivr.net/npm/magic-sdk/dist/magic.min.js"></script>

  <!-- Ethers -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <script>
    const magic = new Magic("pk_live_4F635AECC56B742B");

    const emailInput = document.getElementById("emailInput");
    const magicBtn = document.getElementById("magicLogin");
    const metamaskBtn = document.getElementById("metamaskLogin");

    // MAGIC LOGIN
    magicBtn.addEventListener("click", async () => {
      const email = emailInput.value.trim();
      if (!email) return alert("Enter email.");

      try {
        magicBtn.textContent = "Sending Magic Link...";
        await magic.auth.loginWithEmailOTP({ email });

        localStorage.setItem("auth_method", "magic");
        localStorage.setItem("magic_user", email);

        window.location.href = "dashboard.html";
      } catch (err) {
        console.error(err);
        alert("Magic login failed.");
      } finally {
        magicBtn.textContent = "Login using email";
      }
    });

    // METAMASK LOGIN
    metamaskBtn.addEventListener("click", async () => {
      if (!window.ethereum) {
        alert("MetaMask not found.");
        return;
      }

      try {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const accounts = await provider.send("eth_requestAccounts", []);
        const address = accounts[0];

        localStorage.setItem("auth_method", "metamask");
        localStorage.setItem("metamask_address", address);

        window.location.href = "dashboard.html";
      } catch (err) {
        console.error(err);
        alert("MetaMask connection failed.");
      }
    });
  </script>

</body>
</html>
